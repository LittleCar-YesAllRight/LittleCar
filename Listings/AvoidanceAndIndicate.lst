C51 COMPILER V9.54   AVOIDANCEANDINDICATE                                                  07/23/2020 18:41:07 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE AVOIDANCEANDINDICATE
OBJECT MODULE PLACED IN .\Objects\AvoidanceAndIndicate.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE AvoidanceAndIndicate.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\Listings\AvoidanceAndIndicate.lst) TABS(2) OBJECT(.\Objects\AvoidanceAndIndicate.obj)

line level    source

   1          #include "reg52.h"
   2          #define turn_time 5
   3          // 数字灯
   4          sbit led_S=P0^1;  // 中间杠
   5          sbit led_LF=P0^2;  // 左前杠
   6          sbit led_LB=P0^3;  // 左后杠
   7          sbit led_B=P0^4;  // 后杠
   8          sbit led_RB=P0^5;  // 右后杠
   9          sbit led_RF=P0^6;  // 右前杠
  10          sbit led_F=P0^7;  // 前杠
  11          // 马达
  12          sbit moto_RF=P1^6;  // 右轮向前 
  13          sbit moto_RB=P1^5;  // 右轮向后
  14          sbit moto_LF=P1^4;  // 左轮向前
  15          sbit moto_LB=P1^3;  // 左轮向后
  16          // 红外避障串口,有障碍为0
  17          sbit lavoidance=P3^4;  // 左红外
  18          sbit ravoidance=P3^5;  // 右红外
  19          // 巡线串口, 压线为0
  20          sbit linspection=P3^7;  // 左巡线
  21          sbit rinspection=P3^6;  // 右巡线
  22          void Delay(unsigned short num);
  23          void CarRun(unsigned char dire,unsigned char mode);
  24          void FlashLED();
  25          int AvoidanceAndIndicate();
  26          
  27          int main(void)                                                                                            
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
C51 COMPILER V9.54   AVOIDANCEANDINDICATE                                                  07/23/2020 18:41:07 PAGE 2   

             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
C51 COMPILER V9.54   AVOIDANCEANDINDICATE                                                  07/23/2020 18:41:07 PAGE 3   

             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                                                                                                                        
             -                         
  28          {
  29   1        AvoidanceAndIndicate();
  30   1        while(1);
  31   1      }
  32          
  33          // 巡线和避障
  34          int AvoidanceAndIndicate()
  35          {
  36   1        while(1)
  37   1        {
  38   2          // 拿在空中 或者 碰到黑线 就停
  39   2          if(linspection==1 && rinspection==1)
  40   2          {
  41   3            CarRun('S','T');
  42   3            continue;
  43   3          }
  44   2          // 避障
  45   2          if(lavoidance==1 && ravoidance==1 && linspection==0 && rinspection==0)  // 没有障碍,并且不压线
  46   2            CarRun('F','T');
  47   2          else if(lavoidance==0 && ravoidance==1)  // 左边有障碍
  48   2          {
  49   3            CarRun('R','T');
  50   3            Delay(turn_time);
  51   3          }
  52   2          else if(lavoidance==1 && ravoidance==0)  // 右边有障碍
  53   2          {
  54   3            CarRun('L','T');
  55   3            Delay(turn_time);
  56   3          }
  57   2          else if(lavoidance==0 && ravoidance==0)  // 前面有障碍
  58   2          {
  59   3            CarRun('L','B');
  60   3          }
  61   2          //巡线
  62   2          if(linspection==0 && rinspection==1)
  63   2            CarRun('R','F');
  64   2          else if(linspection==1 && rinspection==0)
  65   2            CarRun('L','F');
  66   2        }
  67   1        
  68   1      }
  69          
  70          
  71          /***********************************
  72          *函数名称:void Delay(unsigned short num)
  73          *函数功能:延时
  74          *参数说明:num 延时时间 值最大255
  75          
C51 COMPILER V9.54   AVOIDANCEANDINDICATE                                                  07/23/2020 18:41:07 PAGE 4   

  76          ***********************************/
  77          void Delay(unsigned short num)
  78          {
  79   1          unsigned int temp=0;
  80   1          while(num--)
  81   1          {
  82   2              temp=200;
  83   2              while(temp--);
  84   2          }
  85   1      }
  86          
  87          
  88          
  89          /***********************************
  90          *函数名称：void CarRun(unsigned char dire)
  91          *函数功能：行进方向控制
  92          *参数说明：dire 方向 'S'：停止   'F'：前   'B'：后   'L'：左   'R'：右
  93                     mode 转向方式 'F'：一前一停   'B'：一后一停   'T'：坦克式，一前一后
  94          
  95          ***********************************/
  96          void CarRun(unsigned char dire,unsigned char mode)
  97          {
  98   1          switch (dire)
  99   1          {
 100   2              case 'S':             //停止
 101   2                  FlashLED();
 102   2                  moto_RF=0;
 103   2                  moto_RB=0;
 104   2                  moto_LF=0;
 105   2                  moto_LB=0;
 106   2                  led_S=0;
 107   2                  break;
 108   2              case 'F':            //前进
 109   2                  FlashLED();
 110   2                  moto_RF=1;
 111   2                  moto_RB=0;
 112   2                  moto_LF=1;
 113   2                  moto_LB=0;
 114   2                  led_F=0;
 115   2                  break;
 116   2              case 'B':            //后退 
 117   2                  FlashLED();       
 118   2                  moto_RF=0;
 119   2                  moto_RB=1;
 120   2                  moto_LF=0;
 121   2                  moto_LB=1;
 122   2                  led_B=0;
 123   2            break;
 124   2              case 'L':            //左转        
 125   2                  FlashLED();
 126   2                  if(mode=='B')
 127   2                    moto_RF=0;
 128   2                  else
 129   2                  {
 130   3                    moto_RF=1;
 131   3                    led_LF=0;
 132   3                  }
 133   2                  moto_RB=0;
 134   2                  moto_LF=0;
 135   2                  if(mode=='F')
 136   2                    moto_LB=0;
 137   2                  else
C51 COMPILER V9.54   AVOIDANCEANDINDICATE                                                  07/23/2020 18:41:07 PAGE 5   

 138   2                  {
 139   3                    moto_LB=1;
 140   3                    led_LB=0;
 141   3                  }
 142   2            break;
 143   2              case 'R':            //右转
 144   2                  FlashLED();
 145   2                  moto_RF=0;
 146   2                  if(mode=='F')
 147   2                    moto_RB=0;
 148   2                  else
 149   2                  {
 150   3                    moto_RB=1;
 151   3                    led_RB=0;
 152   3                  }
 153   2                  if(mode=='B')
 154   2                    moto_LF=0;
 155   2                  else
 156   2                  {
 157   3                    moto_LF=1;
 158   3                    led_RF=0;
 159   3                  }
 160   2                  moto_LB=0;
 161   2            break;
 162   2          }
 163   1      }
 164          
 165          /***********************************
 166          *函数名称：void Led(unsigned char dire)
 167          *函数功能：行进方向控制
 168          *参数说明：dire 方向 'S'：停止   'F'：前   'B'：后   'L'：左   'R'：右
 169          
 170          ***********************************/
 171          void FlashLED()
 172          {
 173   1                  led_S=1;//中间杠
 174   1                  led_LF=1;//左前杠
 175   1                  led_LB=1;//左后杠
 176   1                  led_B=1;//后杠
 177   1                  led_RB=1;//右后杠
 178   1                  led_RF=1;//右前杠
 179   1                  led_F=1;//前杠
 180   1      }
 181          /**********************************
 182          ***********************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    285    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
